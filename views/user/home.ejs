<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxe.com</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />   
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

</head>
<body>
    <%- include('../../views/partials/user/header') %>
    
    <div class="hero">
        <div class="floating-elements">
            <div class="floating-dot"></div>
            <div class="floating-dot"></div>
            <div class="floating-dot"></div>
        </div>
        
        <div class="hero-container">
            <div class="hero-image">
                <video autoplay muted loop playsinline>
                    <source src="https://s1.thcdn.com/video/optimised/2025/04/320ba6c7-e42b-4e21-8f62-73ba8be30bdf-CREED_CLASSICS_HERO_16x9-2_optimised.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            
            <div class="hero-content">
                <div class="hero-subtitle">Artisanal Fragrances</div>
                <h2 class="hero-title">Experience <span class="accent">Luxury</span> in Every Bottle</h2>
                <p class="hero-description">The House of Scent is an authentic perfume house dedicated to the creation of highly original, artistic fragrances for men and women, crafted from the finest ingredients the world has to offer.</p>
                <a href="#" class="hero-cta">
                    Discover Collection
                    <svg class="hero-cta-arrow" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 6.293V.5A.5.5 0 0 1 8 0z"/>
                        <path d="M3 5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zM3.5 8a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <div class="main-content">
        <h2 class="section-title">Exclusive To You</h2>

        <div class="features">
            <div class="feature">
                <div class="feature-number">1</div>
                <div class="feature-image-container">
                    <img src="https://static.thcdn.com/images/small/webp/widgets/216-us/09/original-RM_CLASSICS-153809.png" alt="Complimentary Delivery">
                    <div class="feature-overlay">
                       <div class="overlay-icon"><i class="fas fa-truck"></i></div>
                    </div>
                </div>
                <div class="feature-content">
                    <h3>COMPLIMENTARY DELIVERY</h3>
                    <p>Enjoy your premium orders with our complimentary delivery service, ensuring your luxury items arrive safely at your doorstep.</p>
                    <a href="/shop" class="shop-now-btn">
                        Shop Now
                        <span class="btn-icon">→</span>
                    </a>
                </div>
            </div>

            <div class="feature">
                <div class="feature-number">2</div>
                <div class="feature-image-container">
                    <img src="https://static.thcdn.com/images/small/webp/widgets/216-us/16/original-SAMPLE_CLASSICS-153816.png" alt="Elegant Personalization">
                    <div class="feature-overlay">
                       <div class="overlay-icon"><i class="fas fa-star"></i></div>
                    </div>
                </div>
                <div class="feature-content">
                    <h3>ELEGANT PERSONALIZATION</h3>
                    <p>Personalize your fragrance experience with complimentary laser engraving, making each purchase uniquely yours.</p>
                    <a href="#" class="shop-now-btn">
                        Learn More
                        <span class="btn-icon">→</span>
                    </a>
                </div>
            </div>

            <div class="feature">
                <div class="feature-number">3</div>
                <div class="feature-image-container">
                    <img src="https://static.thcdn.com/images/small/webp/widgets/216-us/36/original-AV_CLAS-154036.png" alt="Complimentary Treats">
                    <div class="feature-overlay">
                        <div class="overlay-icon"><i class="fas fa-gift"></i></div>
                    </div>
                </div>
                <div class="feature-content">
                    <h3>COMPLIMENTARY TREATS</h3>
                    <p>Add your selection to the best experience with complimentary treats of your choice, elevating your luxury shopping journey.</p>
                    <a href="/shop" class="shop-now-btn">
                        Shop Now
                        <span class="btn-icon">→</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="product-showcase">
            <div class="floating-elements">
                <div class="floating-particle"></div>
                <div class="floating-particle"></div>
                <div class="floating-particle"></div>
            </div>
            
            <div class="product-container">
                <div class="product-content">
                    <div class="product-badge">New Collection</div>
                    <h2 class="product-title">Eladaria</h2>
                    <div class="title-underline"></div>
                    <p class="product-description">
                        Discover Eladaria, the latest floral fragrance from The House of Scent. Blooming with modernity, it captures a trilogy of roses veiled in the silvery mist of dawn.
                    </p>
                    <a href="/shop" class="product-cta">
                        Shop Now
                        <svg class="product-cta-arrow" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8.636 3.5a.5.5 0 0 0-.5.5v6.793L6.29 8.95a.5.5 0 1 0-.708.708l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5a.5.5 0 1 0-.708-.708L8.636 10.793V4a.5.5 0 0 0-.5-.5z"/>
                            <path d="M2.5 15a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-11z"/>
                        </svg>
                    </a>
                </div>
                
                <div class="product-image-section">
                    <a href="#" class="product-image-link">
                        <img src="https://img4.dhresource.com/webp/m/0x0/f3/albu/jc/j/03/a3db98e5-c3aa-4d7d-aefe-51b721b09934.jpg" 
                             alt="Eladaria Perfume" 
                             class="product-image"
                             loading="lazy">
                    </a>
                </div>
            </div>
        </div>

        <h2 class="section-title">Signature Essentials</h2>

        <div class="celebrity-products">
            <% if (products && products.length > 0) { %>
                <div class="container">
                    <div class="row">
                        <% products.forEach(product => { %>
                            <% if (product.status === 'listed' && product.price < 40000) { %>
                                <div class="col-md-4 col-lg-3 mb-4">
                                    <div class="product-card">
                                        <div class="product-image-container">
                                            <% if (product.bestOffer) { %>
                                                <div class="offer-badge <%= product.bestOffer.offerType %> <%= product.bestOffer.discount >= 40 ? 'limited-time' : '' %>">
                                                    <%= product.bestOffer.discount %>% OFF
                                                </div>
                                            <% } %>
                                            <a href="/productViewPage?id=<%= product._id %>">
                                                <img src="<%= product.productImage && product.productImage.length > 0 ? product.productImage[0] : '/img/placeholder.png' %>" alt="<%= product.productName %>">
                                            </a>
                                            <button class="btn-wishlist" onclick="toggleWishlist('<%= product._id %>', this)">
                                                <i class="<%= wishlistProductIds && wishlistProductIds.includes(product._id.toString()) ? 'fa-solid' : 'fa-regular' %> fa-heart" 
                                                style="<%= wishlistProductIds && wishlistProductIds.includes(product._id.toString()) ? 'color: red;' : '' %>"></i>
                                            </button>
                                        </div>
                                        <div class="product-info p-3">
                                            <h3 class="product-title"><%= product.productName %></h3>
                                            <div class="price-container">
                                                <span class="current-price">₹<%= Math.round(product.discountedPrice) %></span>
                                                <% if (product.discountedPrice < product.price) { %>
                                                    <span class="original-price">₹<%= product.price %></span>
                                                    <span class="discount-percent"><%= Math.round((product.price - product.discountedPrice) / product.price * 100) %>% off</span>
                                                <% } %>
                                            </div>
                                            <button class="add-to-cart" 
                                                    onclick="addToCart('<%= product._id %>', this)" 
                                                    data-product-id="<%= product._id %>"
                                                    data-variants='<%= JSON.stringify(product.variants[0]._id) %>'>
                                                <span class="button-text">Add to bag</span>
                                                <div class="loading-spinner" style="display: none;">
                                                    <i class="fas fa-spinner fa-spin"></i>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                        <% }) %>
                    </div>
                </div>
            <% } else { %>
                <div class="no-products">
                    <h3>No products found</h3>
                    <p>Try adjusting your filters or check back later.</p>
                </div>
            <% } %>
        </div> 


        <div class="flash-sale">
            <h2>Flash Sale On Products</h2>
            <p>Limited time offer on selected premium fragrances. Don't miss out!</p>
            <div class="timer">
                <div>
                    <div class="timer-box" id="hours">23</div>
                    <div class="timer-label">Hours</div>
                </div>
                <div>
                    <div class="timer-box" id="minutes">58</div>
                    <div class="timer-label">Minutes</div>
                </div>
                <div>
                    <div class="timer-box" id="seconds">00</div>
                    <div class="timer-label">Seconds</div>
                </div>
            </div>
            <button class="add-to-cart">SHOP THE SALE</button>
        </div>

        <h2 class="section-title">Our Premium Collection</h2>

        <div class="celebrity-products">
            <% if (products && products.length > 0) { %>
                <div class="container">
                    <div class="row">
                        <% products.forEach(product => { %>
                            <% if (product.status === 'listed' && product.price > 40000) { %>
                                <div class="col-md-4 col-lg-3 mb-4">
                                    <div class="product-card">
                                        <div class="product-image-container">
                                            <% if (product.bestOffer) { %>
                                                <div class="offer-badge <%= product.bestOffer.offerType %> <%= product.bestOffer.discount >= 40 ? 'limited-time' : '' %>">
                                                    <%= product.bestOffer.discount %>% OFF
                                                </div>
                                            <% } %>
                                            <a href="/productViewPage?id=<%= product._id %>">
                                                <img src="<%= product.productImage && product.productImage.length > 0 ? product.productImage[0] : '/img/placeholder.png' %>" alt="<%= product.productName %>">
                                            </a>
                                            <button class="btn-wishlist" onclick="toggleWishlist('<%= product._id %>', this)">
                                                <i class="<%= wishlistProductIds && wishlistProductIds.includes(product._id.toString()) ? 'fa-solid' : 'fa-regular' %> fa-heart" 
                                                style="<%= wishlistProductIds && wishlistProductIds.includes(product._id.toString()) ? 'color: red;' : '' %>"></i>
                                            </button>
                                        </div>
                                        <div class="product-info p-3">
                                            <h3 class="product-title"><%= product.productName %></h3>
                                            <div class="price-container">
                                                <span class="current-price">₹<%= Math.round(product.discountedPrice) %></span>
                                                <% if (product.discountedPrice < product.price) { %>
                                                    <span class="original-price">₹<%= product.price %></span>
                                                    <span class="discount-percent"><%= Math.round((product.price - product.discountedPrice) / product.price * 100) %>% off</span>
                                                <% } %>
                                            </div>
                                            <button class="add-to-cart" 
                                                    onclick="addToCart('<%= product._id %>', this)" 
                                                    data-product-id="<%= product._id %>"
                                                    data-variants='<%= JSON.stringify(product.variants[0]._id) %>'>
                                                <span class="button-text">Add to bag</span>
                                                <div class="loading-spinner" style="display: none;">
                                                    <i class="fas fa-spinner fa-spin"></i>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                        <% }) %>
                    </div>
                </div>
            <% } else { %>
                <div class="no-products">
                    <h3>No products found</h3>
                    <p>Try adjusting your filters or check back later.</p>
                </div>
            <% } %>
        </div>

    </div>
    <%- include("../../views/partials/user/footer") %>   
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
      function showToast(message, icon = 'success') {
        Swal.fire({
          toast: true,
          position: 'top-end',
          icon: icon,
          title: message,
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true,
        });
      }

      async function addToCart(productId, button) {
        try {
          if (!button) {
            console.error('Button element not found');
            return;
          }

          const buttonText = button.querySelector('.button-text');
          const loadingSpinner = button.querySelector('.loading-spinner');
          
          if (!buttonText || !loadingSpinner) {
            console.error('Button elements not found');
            showToast('Something went wrong. Please try again.', 'error');
            return;
          }

          const btnText = buttonText;
          const spinner = loadingSpinner;

          button.disabled = true;
          btnText.style.display = 'none';
          spinner.style.display = 'block';

          let variantId;
          try {
            const variantsData = button.getAttribute('data-variants');
            variantId = variantsData ? JSON.parse(variantsData) : null;
          } catch (e) {
            console.error('Error parsing variants:', e);
            variantId = null;
          }

          const response = await fetch('/cart/add', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              productId: productId,
              variantId,
              quantity: 1,
              isGiftWrapped: false
            }),
            credentials: 'same-origin'
          });

          const contentType = response.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            window.location.href = '/login';
            return;
          }

          const result = await response.json();

          if (result.success) {
            showToast('Added to bag successfully!', 'success');
            if (result.cartCount) {
              const cartCountElement = document.getElementById('cartCount');
              if (cartCountElement) {
                cartCountElement.textContent = result.cartCount;
              }
            }
            if (result.isMaxQuantity) {
              window.location.href = '/cart';
            }
          } else {
            if (result.message && result.message.includes('log in')) {
              window.location.href = '/login';
            } else {
              showToast(result.message || 'Failed to add to cart', 'error');
            }
          }
        } catch (error) {
          console.error('Error adding to cart:', error);
          if (error instanceof SyntaxError && error.message.includes('Unexpected token')) {
            window.location.href = '/login';
            return;
          }
          showToast('Failed to add to cart. Please try again.', 'error');
        } finally {
          if (button) {
            button.disabled = false;
            const btnText = button.querySelector('.button-text');
            const spinner = button.querySelector('.loading-spinner');
            if (btnText) btnText.style.display = 'block';
            if (spinner) spinner.style.display = 'none';
          }
        }
      }

      async function toggleWishlist(productId, button) {
        try {
          const icon = button.querySelector('i');
          const isInWishlist = icon.classList.contains('fa-solid');
          button.disabled = true;

          const url = isInWishlist ? `/wishlist/remove/${productId}` : `/wishlist/add/${productId}`;
          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'same-origin',
          });

          if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
          const result = await response.json();

          if (result.success) {
            if (isInWishlist) {
              icon.classList.remove('fa-solid', 'fa-heart');
              icon.classList.add('fa-regular', 'fa-heart');
              icon.style.color = '';
              showToast('Removed from wishlist', 'success');
            } else {
              icon.classList.remove('fa-regular', 'fa-heart');
              icon.classList.add('fa-solid', 'fa-heart');
              icon.style.color = 'red';
              showToast('Added to wishlist', 'success');
            }
          } else {
            if (result.message.includes('log in')) {
              window.location.href = '/login';
            } else {
              showToast(result.message, 'error');
            }
          }
        } catch (error) {
          console.error('Error toggling wishlist:', error);
          showToast('Failed to update wishlist. Please try again.', 'error');
        } finally {
          button.disabled = false;
        }
      }
    </script>
</body>
</html>